#!/usr/bin/env lua

require('extensions')
local u = require('utils')
local Repo = require('repo')
local c = require('colors')

local env = {}
env.home = os.getenv("HOME")

local scanlist = u.make_dict({
  '~/dots',
  '~/dots/personal',
  '~/repos/ags'
})

local git_repos = {}
local not_repos = {}
for k, _ in pairs(scanlist) do
  local dir = k:gsub('^~', env.home)
  local g = dir .. '/.git'
  if u.exists(g) then
    table.insert(git_repos, dir)
  else
    table.insert(not_repos, dir)
  end
end

local repos = {}
for _, dir in pairs(git_repos) do
  repos[dir] = Repo.new(dir)
end

local main = function ()
  for _, dir in pairs(git_repos) do
    local r = repos[dir]
    local remote = c.green(r.remote)
    local branch = c.gray(r.branch)
    print('\n'..remote..c.gray(' [')..branch..c.gray(']'))
    table.print(r.commits)
    table.print(r.status)
  end
  print()
end

main()
